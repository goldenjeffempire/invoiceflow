{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}
<div class="dashboard-container py-5" data-aos="fade-up">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="fw-bold h2 mb-1">{% if invoice_form.instance.pk %}Edit{% else %}Create{% endif %} Invoice</h1>
            <p class="text-muted small">Fill in the details to generate your invoice</p>
        </div>
        <a href="{% url 'invoices:invoices_list' %}" class="btn btn-secondary-custom px-4">
            <i class="fa-solid fa-arrow-left small"></i> Back to List
        </a>
    </div>

    <div class="card-feature p-5 border-0 shadow-lg bg-glass">
        <form method="POST" class="needs-validation">
            {% csrf_token %}
            
            <div class="row g-4 mb-5">
                <div class="col-lg-12">
                    <h4 class="fw-bold mb-4 border-bottom pb-2">Basic Information</h4>
                </div>
                <div class="col-md-6">
                    <div class="form-group-custom">
                        <label class="form-label fw-bold small text-uppercase text-muted mb-2">Select Client</label>
                        {{ invoice_form.client|as_crispy_field }}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group-custom">
                        <label class="form-label fw-bold small text-uppercase text-muted mb-2">Due Date</label>
                        {{ invoice_form.due_date|as_crispy_field }}
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="form-group-custom">
                        <label class="form-label fw-bold small text-uppercase text-muted mb-2">Invoice Title</label>
                        {{ invoice_form.title|as_crispy_field }}
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="form-group-custom">
                        <label class="form-label fw-bold small text-uppercase text-muted mb-2">Description / Notes</label>
                        {{ invoice_form.description|as_crispy_field }}
                    </div>
                </div>
            </div>
            
            <div class="items-section mb-5">
                <h4 class="fw-bold mb-4 border-bottom pb-2">Line Items</h4>
                {{ formset.management_form }}
                <div class="table-responsive rounded-4 overflow-hidden border">
                    <table class="table mb-0 align-middle">
                        <thead class="bg-light">
                            <tr>
                                <th class="ps-4 py-3 small fw-bold text-uppercase text-muted">Description</th>
                                <th class="py-3 small fw-bold text-uppercase text-muted" style="width: 120px;">Qty</th>
                                <th class="py-3 small fw-bold text-uppercase text-muted" style="width: 180px;">Unit Price</th>
                                <th class="pe-4 py-3 text-end" style="width: 100px;">Remove</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for form in formset %}
                                <tr class="item-row">
                                    <td class="ps-4">{{ form.description|as_crispy_field }}</td>
                                    <td>{{ form.quantity|as_crispy_field }}</td>
                                    <td>{{ form.unit_price|as_crispy_field }}</td>
                                    <td class="pe-4 text-end">
                                        <div class="form-check d-inline-block">
                                            {{ form.DELETE }}
                                            <label class="form-check-label text-danger" for="{{ form.DELETE.id_for_label }}">
                                                <i class="fa-solid fa-trash-can"></i>
                                            </label>
                                        </div>
                                    </td>
                                    {% for hidden in form.hidden_fields %}{{ hidden }}{% endfor %}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="mt-3 text-end">
                    <button type="button" class="btn btn-sm btn-outline-primary rounded-pill px-3">
                        <i class="fa-solid fa-plus small"></i> Add Line Item
                    </button>
                </div>
            </div>
            
            <div class="d-flex justify-content-end gap-3 mt-5 pt-4 border-top">
                <button type="reset" class="btn btn-secondary-custom px-5">Clear Form</button>
                <button type="submit" class="btn btn-primary-custom px-5">
                    <i class="fa-solid fa-cloud-arrow-up small"></i> Save Invoice
                </button>
            </div>
        </form>
    </div>
</div>

<style>
    .bg-glass { background: var(--glass-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid var(--glass-border) !important; }
    .asteriskField { display: none; }
    .form-group-custom .controls { margin-bottom: 0; }
    .item-row td { padding: 1.5rem 0.5rem; }
    .item-row .mb-3 { margin-bottom: 0 !important; }
    .form-control, .form-select { border-radius: 0.75rem; border: 1px solid #e2e8f0; padding: 0.75rem 1rem; font-size: 0.95rem; }
    .form-control:focus, .form-select:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(0, 102, 255, 0.1); }
    [data-theme="dark"] .form-control, [data-theme="dark"] .form-select { background-color: var(--bg-light); border-color: #374151; color: white; }
</style>
{% endblock %}